(function(e,y){typeof exports=="object"&&typeof module<"u"?module.exports=y(require("vue")):typeof define=="function"&&define.amd?define(["vue"],y):(e=typeof globalThis<"u"?globalThis:e||self,e.SilentBox=y(e.Vue))})(this,function(e){"use strict";const y=n=>{const t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/.exec(n);return t!=null&&t[7]!==void 0?t[7]:""},w=n=>{const t=/(vimeo(pro)?\.com)\/(?:[^\d]+)?(\d+)\??(.*)?$/.exec(n);return t?t[3]:""},C=n=>{if(I(n))try{const l=new XMLHttpRequest;return l.open("GET",n,!1),l.send(null),JSON.parse(l.responseText)}catch(l){return console.log(l),null}throw new Error("Given string: url is not valid URL address.")},k=n=>["youtube.com","youtu.be","vimeo.com"].some(t=>n.includes(t)),L=n=>[".mp4",".ogg",".webm",".mov",".flv",".wmv",".mkv"].some(t=>n.toLowerCase().includes(t)),$=(n,l="")=>{var t;if(/(youtu\.?be)/.test(n)){const r=y(n);return`${location.protocol}//img.youtube.com/vi/${r}/hqdefault.jpg`}else if(/(vimeo(pro)?\.com)/.test(n)){const r=w(n),a=C(`${location.protocol}//vimeo.com/api/v2/video/${r}.json`);return a&&a.length>0?(t=a[0])==null?void 0:t.thumbnail_medium:l}else{if(I(n))return n;throw new Error("Given string: src is not valid URL address.")}},I=n=>new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(n),S=e.createElementVNode("div",{id:"silentbox-overlay__background"},null,-1),N=["onClick"],T={id:"silentbox-overlay__embed"},R={id:"silentbox-overlay__container"},G=["allow","src"],M={key:1,class:"silentbox-video__frame"},U=["src","autoplay","controls"],z=["srcset","src","alt"],K=["onClick","onKeyup"],Y=[e.createElementVNode("div",{class:"icon"},null,-1)],O={key:0,id:"silentbox-overlay__arrow-buttons"},P=["onClick","onKeyup"],X=["onClick","onKeyup"],E=e.defineComponent({__name:"SilentBoxOverlay",props:{item:null,visible:{type:Boolean},currentItem:null,totalItems:null},emits:["silentbox-internal-close-overlay","silentbox-internal-get-next-item","silentbox-internal-get-prev-item","silentbox-overlay-opened","silentbox-overlay-hidden"],setup(n,{emit:l}){const t=n,r=s=>{let i="";const d=y(s);return d&&(i=`${location.protocol}//www.youtube.com/embed/${d}?rel=0`,t.item.autoplay&&(i+="&autoplay=1"),t.item.controls||(i+="&controls=0")),i},a=s=>{let i="";const d=w(s);return d&&(i=`${location.protocol}//player.vimeo.com/video/${d}?rel=0`,t.item.autoplay&&(i+="&autoplay=1")),i},c=s=>/(youtu\.?be)/.test(s)?r(s):/(vimeo(pro)?\.com)/.test(s)?a(s):s,_=()=>{document.body.classList.contains("silentbox-is-opened")||document.body.classList.add("silentbox-is-opened")},x=()=>{document.body.classList.contains("silentbox-is-opened")&&document.body.classList.remove("silentbox-is-opened")},b=e.reactive({name:"silentbox-animation__swipe-left"}),h=()=>{l("silentbox-internal-close-overlay")},m=()=>{b.name="silentbox-animation__swipe-left",l("silentbox-internal-get-next-item")},p=()=>{b.name="silentbox-animation__swipe-right",l("silentbox-internal-get-prev-item")},u=e.reactive({posX:0,posY:0}),f=s=>{const{clientX:i,clientY:d}=s.touches[0];u.posX=i,u.posY=d},v=s=>{const{clientX:i,clientY:d}=s.touches[0],{posX:g,posY:B}=u;if(g===0||B===0)return;const V=g-i,H=B-d;Math.abs(V)>Math.abs(H)&&(V>0?m():p()),u.posX=0,u.posY=0},o=s=>{s.code==="Escape"&&h(),s.code==="ArrowRight"&&m(),s.code==="ArrowLeft"&&p()};return e.onUpdated(()=>{t.visible?(window.addEventListener("keyup",o),_()):(window.removeEventListener("keyup",o),x())}),(s,i)=>t.visible?(e.openBlock(),e.createElementBlock("div",{key:0,id:"silentbox-overlay",role:"overlay",onTouchstart:f,onTouchmove:v},[S,e.createVNode(e.Transition,{name:b.name,mode:"out-in"},{default:e.withCtx(()=>[(e.openBlock(),e.createElementBlock("div",{id:"silentbox-overlay__content",onClick:e.withModifiers(h,["stop"]),key:t.item.src},[e.createElementVNode("div",T,[e.createElementVNode("div",R,[e.unref(k)(t.item.src)?(e.openBlock(),e.createElementBlock("iframe",{key:0,allow:`accelerometer; ${!!t.item.autoplay&&"autoplay;"} encrypted-media; gyroscope; picture-in-picture`,src:c(t.item.src),frameborder:"0",width:"100%",height:"100%",allowfullscreen:""},null,8,G)):e.unref(L)(t.item.src)?(e.openBlock(),e.createElementBlock("div",M,[e.createElementVNode("video",{src:t.item.src,autoplay:!!t.item.autoplay,controls:t.item.controls,class:"silentbox-video__embed"},null,8,U)])):(e.openBlock(),e.createElementBlock("img",{key:2,srcset:t.item.srcSet?t.item.srcSet.join(","):t.item.src,src:t.item.src,alt:t.item.alt},null,8,z))]),t.item.description?(e.openBlock(),e.createElementBlock("p",{key:0,id:"silentbox-overlay__description",onClick:i[0]||(i[0]=e.withModifiers(()=>{},["prevent","stop"]))},e.toDisplayString(t.item.description),1)):e.createCommentVNode("",!0)])],8,N))]),_:1},8,["name"]),e.createElementVNode("button",{id:"silentbox-overlay__close-button",role:"button",tabindex:"3",onClick:e.withModifiers(h,["prevent"]),onKeyup:e.withKeys(h,["enter"])},Y,40,K),t.totalItems>1?(e.openBlock(),e.createElementBlock("div",O,[e.createElementVNode("button",{class:"arrow arrow-previous",role:"button",tabindex:"2",onClick:e.withModifiers(p,["stop"]),onKeyup:e.withKeys(p,["enter"])},null,40,P),e.createElementVNode("button",{class:"arrow arrow-next",role:"button",tabindex:"1",onClick:e.withModifiers(m,["stop"]),onKeyup:e.withKeys(m,["enter"])},null,40,X)])):e.createCommentVNode("",!0)],32)):e.createCommentVNode("",!0)}}),F="",j=["href","onClick"],A=["loading","src","alt","width","height"],D=e.defineComponent({__name:"SilentBoxGallery",props:{lazyLoading:{type:Boolean},previewCount:null,fallbackThumbnail:null,gallery:null,image:null},emits:["silentbox-overlay-opened","silentbox-overlay-hidden","silentbox-overlay-next-item-displayed","silentbox-overlay-prev-item-displayed"],setup(n,{expose:l,emit:t}){const r=n,a=e.computed(()=>r.gallery?r.gallery.length:1),c=e.reactive({item:{src:"",alt:"",thumbnailWidth:150,thumbnailHeight:0,thumbnail:"",autoplay:!1,controls:!0,description:""},visible:!1,currentItem:0,totalItems:a}),_=o=>k(o)?$(o,r.fallbackThumbnail):o,x=o=>({...c.item,...o,thumbnail:o.thumbnail?o.thumbnail:_(o.src)}),b=()=>r.gallery&&r.gallery.length>0?r.gallery.map(x):r.image?[x(r.image)]:[],h=e.computed(()=>r.previewCount&&r.previewCount>0&&r.gallery?r.gallery.slice(0,r.previewCount).map(x):b()),m=e.computed(()=>b()),p=(o,s=0)=>{c.visible=!0,c.item=o,c.currentItem=s,t("silentbox-overlay-opened",o)},u=()=>{c.visible=!1,t("silentbox-overlay-hidden",c.item)},f=()=>{let o=c.currentItem+1;o=o<=m.value.length-1?o:0,c.item=m.value[o],c.currentItem=o,t("silentbox-overlay-next-item-displayed",c.item)},v=()=>{let o=c.currentItem-1;o=o>=0?o:m.value.length-1,c.item=m.value[o],c.currentItem=o,t("silentbox-overlay-prev-item-displayed",c.item)};return l({openOverlay:p}),(o,s)=>(e.openBlock(),e.createElementBlock("div",null,[e.renderSlot(o.$slots,"default"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(i,d)=>(e.openBlock(),e.createElementBlock("a",{key:i.src,href:i.src,onClick:e.withModifiers(g=>p(i,d),["prevent"]),class:"silentbox-item"},[e.renderSlot(o.$slots,"silentbox-item",{silentboxItem:i},()=>[e.createElementVNode("img",{loading:n.lazyLoading?"lazy":"eager",src:i.thumbnail,alt:i.alt,width:i.thumbnailWidth,height:i.thumbnailHeight},null,8,A)])],8,j))),128)),e.createVNode(E,{visible:c.visible,item:c.item,"current-item":c.currentItem,"total-items":e.unref(a),onSilentboxInternalCloseOverlay:u,onSilentboxInternalGetNextItem:f,onSilentboxInternalGetPrevItem:v},null,8,["visible","item","current-item","total-items"])]))}}),W="";return{install:n=>{n.component("silent-box",D),n.config.globalProperties.$silentbox={open:l=>{const t=document.createElement("div");t.setAttribute("id","silentbox--false-root");const r=e.createApp(E,{item:l,currentItem:1,totalItems:1,visible:!0,onSilentboxInternalCloseOverlay:()=>{a.$emit("silentbox-overlay-hidden",l),r.unmount(),t.remove()}}),a=r.mount(t);a.$emit("silentbox-overlay-opened",l),a.$forceUpdate(),document.body.appendChild(a.$el)}}}}});
